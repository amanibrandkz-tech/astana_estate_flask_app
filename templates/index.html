<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Прогноз стоимости жилья в Астане</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0c1024;
      --card: rgba(14, 18, 42, 0.7);
      --stroke: rgba(255, 255, 255, 0.08);
      --accent: #ffb347;
      --accent-2: #5ad8ff;
      --text: #f4f6fb;
      --muted: #a9b3ce;
      --error: #ff6b6b;
      --radius: 16px;
      --shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      font-family: 'Space Grotesk', 'Inter', system-ui, -apple-system, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 20% 20%, rgba(90, 216, 255, 0.18), transparent 35%),
                  radial-gradient(circle at 80% 10%, rgba(255, 179, 71, 0.16), transparent 32%),
                  radial-gradient(circle at 50% 80%, rgba(255, 255, 255, 0.05), transparent 40%),
                  var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }
    .shell {
      width: min(1200px, 100%);
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 28px;
      position: relative;
    }
    @media (max-width: 960px) {
      .shell { grid-template-columns: 1fr; }
    }
    .hero {
      padding: 32px;
      border-radius: var(--radius);
      background: linear-gradient(145deg, rgba(255, 179, 71, 0.2), rgba(90, 216, 255, 0.18));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 70% 20%, rgba(255,255,255,0.18), transparent 40%);
      opacity: 0.7;
      pointer-events: none;
    }
    .title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 4vw, 40px);
      margin: 0 0 12px;
      letter-spacing: -0.02em;
    }
    .subtitle {
      margin: 0;
      color: var(--muted);
      line-height: 1.6;
      max-width: 32ch;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--accent);
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--stroke);
      font-size: 13px;
      letter-spacing: 0.02em;
    }
    .card {
      padding: 28px;
      border-radius: var(--radius);
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(16px);
    }
    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px 16px;
      margin-top: 12px;
    }
    label {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }
    .field { display: flex; flex-direction: column; }
    input, select {
      width: 100%;
      padding: 12px 13px;
      border-radius: 12px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,0.03);
      color: var(--text);
      font-size: 15px;
      transition: border 0.18s ease, transform 0.18s ease, background 0.18s ease;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-2);
      background: rgba(255,255,255,0.06);
      transform: translateY(-1px);
    }
    .helper-text {
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
      margin-top: 4px;
    }
    .actions {
      grid-column: 1 / -1;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
    }
    button {
      padding: 14px 22px;
      border-radius: 14px;
      border: none;
      background: linear-gradient(120deg, var(--accent), var(--accent-2));
      color: #0c0f1c;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 12px 30px rgba(90, 216, 255, 0.25);
      transition: transform 0.18s ease, box-shadow 0.18s ease;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 16px 36px rgba(90, 216, 255, 0.3); }
    button:active { transform: translateY(0); }
    .note { font-size: 13px; color: var(--muted); }
    .result {
      grid-column: 1 / -1;
      margin-top: 8px;
      padding: 14px 16px;
      border-radius: 12px;
      border: 1px dashed var(--stroke);
      color: var(--text);
      background: rgba(255,255,255,0.03);
    }
    .result.negative { color: var(--error); border-color: rgba(255,107,107,0.5); }
  </style>
</head>
<body>
  <div class="shell">
    <section class="hero">
      <div class="pill">ML‑оценка в пару кликов</div>
      <h1 class="title">Прогноз стоимости жилья в Астане</h1>
      <p class="subtitle">Вводите параметры квартиры, адрес и получите ориентировочную цену на основе модели CatBoost, учитывающей локацию и окружение.</p>
    </section>

    <section class="card">
      <form action="{{ url_for('predict') }}" method="post">
        <div class="field">
          <label for="owner">Ваш статус</label>
          <select id="owner" name="owner">
            <option value="owner">Хозяин недвижимости</option>
            <option value="agent">Риелтор</option>
          </select>
        </div>

        <div class="field">
          <label for="complexInput">Название комплекса</label>
          <input type="text" id="complexInput" name="complex_name" placeholder="Название ЖК" list="complexList" required autocomplete="off" onfocus="if (this.showPicker) this.showPicker();" />
          <div class="helper-text">Если дом до 2000 года или без названия: no name / «бережневка» / «панелька нового типа».</div>
          <datalist id="complexList"></datalist>
        </div>

        <div class="field">
          <label for="address">Адрес</label>
          <input type="text" id="address" name="address" placeholder="Сарайшык, 38" required />
        </div>

        <div class="field">
          <label for="house_type">Тип дома</label>
          <select id="house_type" name="house_type">
            <option value="monolithic">монолитный</option>
            <option value="panel">панельный</option>
            <option value="brick">кирпичный</option>
          </select>
        </div>

        <div class="field">
          <label for="in_pledge">В залоге?</label>
          <select id="in_pledge" name="in_pledge">
            <option value="no">Нет</option>
            <option value="yes">Да</option>
          </select>
        </div>

        <div class="field">
          <label for="construction_year">Год постройки</label>
          <input type="number" id="construction_year" name="construction_year" min="1949" max="2050" required />
        </div>

        <div class="field">
          <label for="ceiling_height">Высота потолков (м)</label>
          <input type="number" id="ceiling_height" name="ceiling_height" min="2" max="5" step="0.01" required />
        </div>

        <div class="field">
          <label for="bathroom_info">Санузел</label>
          <select id="bathroom_info" name="bathroom_info">
            <option value="combined">совмещенный</option>
            <option value="separate">раздельный</option>
            <option value="2 or more">2 и более</option>
          </select>
        </div>

        <div class="field">
          <label for="condition">Состояние</label>
          <select id="condition" name="condition">
            <option value="rough">хорошее</option>
            <option value="average">среднее</option>
            <option value="good">черновая отделка/требует ремонта</option>
          </select>
        </div>

        <div class="field">
          <label for="area">Площадь (м²)</label>
          <input type="number" id="area" name="area" min="10" max="1000" step="0.01" required />
        </div>

        <div class="field">
          <label for="room_count">Комнат</label>
          <input type="number" id="room_count" name="room_count" min="1" max="15" required />
        </div>

        <div class="field">
          <label for="floor">Этаж</label>
          <input type="number" id="floor" name="floor" min="1" max="50" required />
        </div>

        <div class="field">
          <label for="floor_count">Этажность дома</label>
          <input type="number" id="floor_count" name="floor_count" min="1" max="50" required />
        </div>

        <div class="field">
          <label for="district">Район</label>
          <select id="district" name="district">
            <option value="almaty">Алматы р-н</option>
            <option value="esil">Есильский р-н</option>
            <option value="nura">Нура р-н</option>
            <option value="saryarka">Сарыарка р-н</option>
            <option value="baikonur">Байконур р-н</option>
          </select>
        </div>

        <div class="field">
          <label for="complex_class">Класс ЖК</label>
          <select id="complex_class" name="complex_class">
            <option value="economy">эконом</option>
            <option value="comfort">комфорт</option>
            <option value="business">бизнес</option>
            <option value="premium">премиум</option>
          </select>
        </div>

        <div class="field">
          <label for="parking">Паркинг</label>
          <select id="parking" name="parking">
            <option value="no">нету</option>
            <option value="underground">подземный</option>
            <option value="aboveground">надземный (крытый)</option>
          </select>
        </div>

        <div class="field">
          <label for="elevator">Лифт</label>
          <select id="elevator" name="elevator">
            <option value="yes">есть</option>
            <option value="no">нету</option>
          </select>
        </div>

        <div class="actions">
          <button type="submit">Предсказать стоимость</button>
          <div class="note">Адрес геокодируется через 2GIS. Убедитесь, что формат похож на «Сарайшык, 38».</div>
        </div>

        {% if prediction_text %}
        <div class="result {% if 'не удалось' in prediction_text.lower() %}negative{% endif %}">
          {{ prediction_text }}
        </div>
        {% endif %}
      </form>
    </section>
  </div>

  <!-- JavaScript for loading complexes into datalist -->
  <script>
    function readCSVFile(filename, callback) {
      var request = new XMLHttpRequest();
      request.onload = function() {
        if (request.status === 200) callback(request.responseText);
      };
      request.open("GET", filename, true);
      request.send();
    }

    function csvToArray(csvData) {
      return csvData.trim().split('\\n').map(function(line) {
        return { name: line.trim() };
      }).filter(function(item) { return item.name; });
    }

    readCSVFile("/data/complexes.csv", function(csvData) {
      var complexData = csvToArray(csvData);
      var datalistElement = document.getElementById("complexList");
      var input = document.getElementById("complexInput");
      complexData.forEach(function(complex) {
        var option = document.createElement("option");
        option.value = complex.name;
        datalistElement.appendChild(option);
      });
      // Авто-раскрытие списка на фокус (там, где браузер поддерживает showPicker).
      if (input && input.showPicker) {
        input.addEventListener("focus", function() { input.showPicker(); });
      }
    });
  </script>
</body>
</html>
